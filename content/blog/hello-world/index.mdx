---
title: AWS
date: "2022-03-01"
description: "AWSのEC2にrailsをデプロイする方法について解説してみました。"
image_url: "https://cdn.jsdelivr.net/gh/devicons/devicon/icons/docker/docker-original-wordmark.svg"
tags: ["Rails", "Docker", "技術"]
---

## ももクロ天国

<br />
<div class="gatsby-code-title">
  <span>app/controllers/bookmarks_controller.rb</span>
</div>

```ruby{numberLines:true}
Started GET "/users" for 127.0.0.1 at 2021-11-25 08:47:04 +0900
Processing by UsersController#index as HTML
  Rendering layout layouts/application.html.slim
  Rendering users/index.html.erb within layouts/application
  User Load (2.7ms)  SELECT `users`.* FROM `users`
  ↳ app/views/users/index.html.erb:1
   (5.7ms)  SELECT COUNT(*) FROM `products` WHERE 'products`.`user_id` = 10
  ↳ app/views/users/index.html.erb:3
   (4.5ms)  SELECT COUNT(*) FROM `products` WHERE 'products`.`user_id` = 9
  ↳ app/views/users/index.html.erb:3
   (1.5ms)  SELECT COUNT(*) FROM `products` WHERE 'products`.`user_id` = 8
  ↳ app/views/users/index.html.erb:3
   (2.4ms)  SELECT COUNT(*) FROM `products` WHERE 'products`.`user_id` = 7
  ↳ app/views/users/index.html.erb:3
   (5.8ms)  SELECT COUNT(*) FROM `products` WHERE 'products`.`user_id` = 6
  ↳ app/views/users/index.html.erb:3
   (1.4ms)  SELECT COUNT(*) FROM `products` WHERE 'products`.`user_id` = 5
  ↳ app/views/users/index.html.erb:3
   (14.6ms)  SELECT COUNT(*) FROM `products` WHERE 'products`.`user_id` = 4
  ↳ app/views/users/index.html.erb:3
   (3.3ms)  SELECT COUNT(*) FROM `products` WHERE 'products`.`user_id` = 3
  ↳ app/views/users/index.html.erb:3
   (13.1ms)  SELECT COUNT(*) FROM `products` WHERE 'products`.`user_id` = 2
  ↳ app/views/users/index.html.erb:3
   (16.5ms)  SELECT COUNT(*) FROM `products` WHERE 'products`.`user_id` = 1
  ↳ app/views/users/index.html.erb:3
```

ここで下記を実行

```
$ rails db:migrate
```

`User`モデルに`enum`を追加します

<div class="gatsby-code-title">
  <span>app/controllers/admin/user_sessions_controller.rb</span>
</div>

```ruby
class Admin::UserSessionsController < Admin::BaseController
  skip_before_action :require_login, only: %i[new create]
  skip_before_action :check_admin, only: %i[new create]
  layout 'layouts/admin_login'

  def new; end

  def create
    @user = login(params[:email], params[:password])
    if @user
      redirect_to admin_root_path, success: t('.success')
    else
      flash.now[:danger] = t('.fail')
      render :new
    end
  end

  def destroy
    logout
    redirect_to admin_login_path, success: t('.success')
  end
end
```

**aa**は**ももクロ**
